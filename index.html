<!DOCTYPE html>
<html lang="da">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Reaction Time Task</title>

    <!-- jsPsych core library -->
    <script src="https://unpkg.com/jspsych@8.0.0"></script>

    <!-- jsPsych plugins -->
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>

    <!-- CSS for jsPsych -->
    <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />

    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }

        .stimulus {
            font-size: 48px;
            text-align: center;
            margin: 20px;
        }

        .response {
            font-size: 24px;
            text-align: center;
            margin: 20px;
        }
    </style>
</head>

<body>
    <div id="jspsych-target"></div>

    <script>
        // Initialize jsPsych
        const jsPsych = initJsPsych({
            on_finish: function() {
                // When the experiment finishes, we can output the data or send it to a server
                const data = jsPsych.data.get().csv(); // Get data in CSV format
                console.log(data); // Log data in the console (can replace this with an upload)
            }
        });

        // Define timeline
        const timeline = [];

        // Welcome message
        const welcome = {
            type: jsPsychHtmlButtonResponse,
            stimulus: '<h1>Velkommen til eksperimentet!</h1><p>Tryk på "Start" for at begynde.</p>',
            choices: ['Start']
        };
        timeline.push(welcome);

        // Instructions
        const instructions = {
            type: jsPsychHtmlButtonResponse,
            stimulus: '<h2>Opgavebeskrivelse</h2><p>Når du ser et billede, så tryk så hurtigt som muligt på "F" for rød og "J" for blå.</p>',
            choices: ['Fortsæt']
        };
        timeline.push(instructions);

        // Trial definition
        const colors = ['red', 'blue'];
        const keyMap = {
            'red': 'F',
            'blue': 'J'
        };

        // Create trials
        for (let i = 0; i < 10; i++) {
            const color = jsPsych.randomization.sampleWithoutReplacement(colors, 1)[0]; // Randomly select color
            const correctKey = keyMap[color];

            const trial = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: `<div class="stimulus" style="color: ${color};">${color.toUpperCase()}</div>`,
                choices: ['F', 'J'],
                data: { correct_key: correctKey, color: color },
                on_finish: function(data) {
                    const response = data.response;
                    data.correct = response === data.correct_key; // Check if response is correct
                },
                trial_duration: 2000 // Display the stimulus for 2000 ms
            };
            timeline.push(trial);
        }

        // Feedback after each trial
        const feedback = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: function() {
                const lastTrialData = jsPsych.data.getLastTrialData();
                return lastTrialData.correct ? '<div class="response">Korrekt!</div>' : '<div class="response">Forkert!</div>';
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 1000 // Show feedback for 1 second
        };
        timeline.push(feedback);

        // End message
        const endMessage = {
            type: jsPsychHtmlButtonResponse,
            stimulus: '<h1>Tak for din deltagelse!</h1><p>Du kan lukke denne fane.</p>',
            choices: ['Afslut']
        };
        timeline.push(endMessage);

        // Start the experiment
        jsPsych.run(timeline);
    </script>
</body>

</html>

